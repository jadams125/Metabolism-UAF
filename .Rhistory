skip = 1, header = TRUE)
View(strt2021atmo.Data)
View(strt2021atmo.Data)
names(strt2021atmo.Data)[3]= c("pressure.air")
names(strt2021atmo.Data)[2]= c("dateTimePre")
calc_DO_sat()
?calc_DO_sat()
strt2021atmo.Data$datetimeAK <- as.POSIXct(strt2021atmo.Data$dateTimePre, format="%m/%d/%y %I:%M:%S %p", tz="America/Anchorage")
View(strt2021atmo.Data)
salchatest1 <- plyr::join(strt2021atmo.Data, salchaData, by = "datetimeAK")
View(salchatest1)
View(salchatest1)
View(salchatest1)
salchatest1$ModeledDOSat <- calc_DO_sat(salchatest1$Temp.C.mn ,salchatest1$pressure.air, model = "garcia-benson")
View(salchatest1)
salchaData <- salchatest1
salchaData <- salchaData %>% rename(temp.water = Temp.C.mn)
salchaData <- salchaData %>% rename(DO.obs = ODO.mgL.mn)
salchaData <- salchaData %>% rename(DO.sat = ModeledDOSat)
final.salcha.DT <- salchaData %>%
select(discharge, light, temp.water, DO.sat,DO.obs,depth,solar.time)
View(final.salcha.DT)
final.salcha.DT <- na.omit(salchaData) %>%
select(discharge, light, temp.water, DO.sat,DO.obs,depth,solar.time)
View(final.salcha.DT)
str(final.salcha.DT)
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=3000, n_cores=8,
GPP_daily_lower = 0, ER_daily_upper = 0,
)
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=3000, n_cores=4,
GPP_daily_lower = 0, ER_daily_upper = 0,
)
mm.test.salcha.new <- metab(bayes_specs, data=final.salcha.DT)
get_fit(mm.test.salcha.new)
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
library(rstan)
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_name_AppEtAL <- "b_Kb_oipi_tr_plrckm.stan"
bayes_name_AppEtAL
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=9000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
test_dat <- read_rds("C:/Users/jadams125/Documents/data_real.Rds")
test_dat24 <- read_rds("C:/Users/jadams125/Documents/data_realfour.Rds")
nwis_06893820 <- test_dat24$nwis_06893820
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
<<<<<<< Updated upstream
Salcha.exo.2021 <- read.csv(file=file.path("C:/Users/jacob/OneDrive - University of Alaska/GitHub/Salcha/EXO_data/from_internal_harddrive/processed/SALCHA.EXO.aord.csv"))
#DO, water temp, Time
Salcha.exo.2021 <- Salcha.exo.2021 %>% select(ODO.mgL.mn, Temp.C.mn, datetimeAK)
# Discharge and Depth
dischargeSalcha <- read.csv(here("dischargeSalchaTXT.csv"))
dischargeSalcha <- dischargeSalcha[-c(1), ]
dischargeSalcha$datetimeAK <- as.POSIXct(mdy_hm(dischargeSalcha$datetime))
dischargeSalcha$datetimeAK <- force_tz(dischargeSalcha$datetimeAK, "America/Anchorage")
dischargeSalcha$X1761_00065 <- as.numeric(dischargeSalcha$X1761_00065) * 0.3048
dischargeSalcha$X1760_00060 <- as.numeric(dischargeSalcha$X1760_00060) * 0.0283168
dischargeSalcha <- dischargeSalcha %>% rename(depth = X1761_00065)
dischargeSalcha <- dischargeSalcha %>% rename(discharge = X1760_00060)
dischargeSalcha <- dischargeSalcha %>% select(discharge, depth, datetimeAK)
salchaData <- join(Salcha.exo.2021, dischargeSalcha, by = "datetimeAK")
salchaData$datetimeAK <- as.POSIXct(salchaData$datetimeAK)
salchaData$solar.time <- calc_solar_time(salchaData$datetimeAK, -146.9281)
salchaData$light <- calc_light(salchaData$solar.time, 64.47153, -146.9281)
strt.2021.atmo.url <- "https://drive.google.com/drive/u/2/folders/1-om0nU42U8fNmeWtBrhM8WQTbGqBW8RN"
strtatmo <- drive_get(as_id(strt.2021.atmo.url))
=======
library(rstan)
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_name_AppEtAL <- "b_Kb_oipi_tr_plrckm.stan"
bayes_name_AppEtAL
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=9000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
test_dat <- read_rds("C:/Users/jadams125/Documents/data_real.Rds")
test_dat24 <- read_rds("C:/Users/jadams125/Documents/data_realfour.Rds")
nwis_06893820 <- test_dat24$nwis_06893820
View(nwis_06893820)
>>>>>>> Stashed changes
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
<<<<<<< Updated upstream
#Salcha Metabolism Remade
Salcha.exo.2021 <- read.csv(file=file.path("C:/Users/jacob/OneDrive - University of Alaska/GitHub/Salcha/EXO_data/from_internal_harddrive/processed/SALCHA.EXO.aord.csv"))
#DO, water temp, Time
Salcha.exo.2021 <- Salcha.exo.2021 %>% select(ODO.mgL.mn, Temp.C.mn, datetimeAK)
# Discharge and Depth
dischargeSalcha <- read.csv(here("dischargeSalchaTXT.csv"))
dischargeSalcha <- dischargeSalcha[-c(1), ]
dischargeSalcha$datetimeAK <- as.POSIXct(mdy_hm(dischargeSalcha$datetime))
dischargeSalcha$datetimeAK <- force_tz(dischargeSalcha$datetimeAK, "America/Anchorage")
# convert to Meters
dischargeSalcha$X1761_00065 <- as.numeric(dischargeSalcha$X1761_00065) * 0.3048
dischargeSalcha$X1760_00060 <- as.numeric(dischargeSalcha$X1760_00060) * 0.0283168
dischargeSalcha <- dischargeSalcha %>% rename(depth = X1761_00065)
dischargeSalcha <- dischargeSalcha %>% rename(discharge = X1760_00060)
dischargeSalcha <- dischargeSalcha %>% select(discharge, depth, datetimeAK)
salchaData <- join(Salcha.exo.2021, dischargeSalcha, by = "datetimeAK")
salchaData$datetimeAK <- as.POSIXct(salchaData$datetimeAK)
#Solar Time
salchaData$solar.time <- calc_solar_time(salchaData$datetimeAK, -146.9281)
salchaData$light <- calc_light(salchaData$solar.time, 64.47153, -146.9281)
#DO SAT
strt.2021.atmo.url <- "https://drive.google.com/drive/u/2/folders/1-om0nU42U8fNmeWtBrhM8WQTbGqBW8RN"
strtatmo <- drive_get(as_id(strt.2021.atmo.url))
test1strt2021_glist <- drive_ls(strtatmo, pattern = "20005934_STRT_ATMO_210930.csv")
walk(test1strt2021_glist$id, ~ drive_download(as_id(.x), overwrite = TRUE))
strt2021atmo.Data <- read.csv("20005934_STRT_ATMO_210930.csv",
skip = 1, header = TRUE)
names(strt2021atmo.Data)[3]= c("pressure.air")
names(strt2021atmo.Data)[2]= c("dateTimePre")
strt2021atmo.Data$datetimeAK <- as.POSIXct(strt2021atmo.Data$dateTimePre, format="%m/%d/%y %I:%M:%S %p", tz="America/Anchorage")
salchatest1 <- plyr::join(strt2021atmo.Data, salchaData, by = "datetimeAK")
# Salcha_DoD_and_USGS_2021 <- na.omit(Salcha_DoD_and_USGS_2021)
salchatest1$ModeledDOSat <- calc_DO_sat(salchatest1$Temp.C.mn ,salchatest1$pressure.air, model = "garcia-benson")
#metabolism
salchaData <- salchatest1
salchaData <- salchaData %>% rename(temp.water = Temp.C.mn)
salchaData <- salchaData %>% rename(DO.obs = ODO.mgL.mn)
salchaData <- salchaData %>% rename(DO.sat = ModeledDOSat)
final.salcha.DT <- na.omit(salchaData) %>%
select(discharge, light, temp.water, DO.sat,DO.obs,depth,solar.time)
str(final.salcha.DT)
write.csv(final.salcha.DT, here("outputs", "correctedSalchaDT.csv"))
=======
>>>>>>> Stashed changes
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
library(rstan)
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_name_AppEtAL <- "b_Kb_oipi_tr_plrckm.stan"
bayes_name_AppEtAL
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=9000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
dat <- data_metab(num_days='3', res='15', day_start=4, day_end=28)
test_dat <- read_rds("C:/Users/jadams125/Documents/data_real.Rds")
test_dat24 <- read_rds("C:/Users/jadams125/Documents/data_realfour.Rds")
nwis_06893820 <- test_dat24$nwis_06893820
View(nwis_06893820)
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
Salcha.exo.2021 <- read.csv(file=file.path("C:/Users/jacob/OneDrive - University of Alaska/GitHub/Salcha/EXO_data/from_internal_harddrive/processed/SALCHA.EXO.aord.csv"))
#DO, water temp, Time
Salcha.exo.2021 <- Salcha.exo.2021 %>% select(ODO.mgL.mn, Temp.C.mn, datetimeAK)
# Discharge and Depth
dischargeSalcha <- read.csv(here("dischargeSalchaTXT.csv"))
View(nwis_06893820)
write.csv(nwis_06893820, here("outputs", "testNWISdata.csv"))
# install devtools package
install.packages(c("devtools"))
install.packages(c("devtools"))
install.packages(c("devtools"))
install.packages(c("devtools"))
install.packages(c("devtools"))
# install BASEmetab package
devtools::install_github("dgiling/BASEmetab")
# install BASEmetab package
devtools::install_github("dgiling/BASEmetab")
update.packages("cli")
library(cli)
library("devtools")
install.packages("cli")
install.packages("cli")
install.packages("cli")
install.packages("cli")
# install BASEmetab package
devtools::install_github("dgiling/BASEmetab")
install.packages(remotes)
install.packages("remotes")
# install BASEmetab package
devtools::install_github("dgiling/BASEmetab")
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
library(rstan)
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_name_AppEtAL <- "b_Kb_oipi_tr_plrckm.stan"
bayes_name_AppEtAL
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=9000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
dat <- data_metab(num_days='3', res='15', day_start=4, day_end=28)
mm.test.dat <- metab(bayes_specs, data=dat)
bayes_name <- mm_name(type='bayes', pool_K600='none', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
#FRCH
setwd(here())
FRCH.comb <- read.csv(here("outputs", "frch.comb.csv"))
FRCH.comb <- FRCH.comb %>% filter(datetimeAK < "2019-08-01 00:00:00" & datetimeAK >= "2019-07-01 00:00:00")
FRCH.comb$datetimeAK <- force_tz(as.POSIXct(FRCH.comb$datetimeAK), "America/Anchorage")
remove.packages("lubridate")
install.packages("lubridate")
install.packages("lubridate")
remove.packages("lubridate")
remove.packages("lubridate")
install.packages("lubridate")
library(lubridate)
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
library(rstan)
#FRCH
setwd(here())
FRCH.comb <- read.csv(here("outputs", "frch.comb.csv"))
FRCH.comb <- FRCH.comb %>% filter(datetimeAK < "2019-08-01 00:00:00" & datetimeAK >= "2019-07-01 00:00:00")
FRCH.comb$datetimeAK <- force_tz(as.POSIXct(FRCH.comb$datetimeAK), "America/Anchorage")
FRCH.comb$solar.time <- calc_solar_time(as.POSIXct(FRCH.comb$datetimeAK), longitude = -146.916364)
data.frch.mm <- na.omit(FRCH.comb) %>%
select(solar.time, depth, DO.obs, DO.sat, temp.water, light)
data.frch.mm$solar.time <- as.POSIXct(data.frch.mm$solar.time, tz = "UTC")
parMod <- calc_light(data.frch.mm$solar.time, 64.60667379, -146.916364)
timebounds <- as.POSIXct(c('2019-08-01 00:00:00', '2019-07-01 00:00:00'), tz= "America/Anchorage")
coords <- list(lat=64.60667379, lon=-146.916364)
PAR.obs <- data.frch.mm %>%
select(solar.time, light)
lightmerged <- calc_light_merged( PAR.obs, solar.time = data.frch.mm$solar.time, 64.60667379, -146.916364)
data.frch.mm <- data.frch.mm %>%
dplyr::rename(light.obs = light)
data.frch.mm <- merge(lightmerged, data.frch.mm, by = "solar.time")
View(data.frch.mm)
data.frch.mm <- na.omit(data.frch.mm) %>%
select(solar.time, depth, DO.obs, DO.sat, temp.water, light)
mm.test.frch <- metab(bayes_specs, data=data.frch.mm)
bayes_name <- mm_name(type='bayes', pool_K600='none', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_specs <- specs(bayes_name,
burnin_steps=1000, saved_steps=9000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
mm.test.frch <- metab(bayes_specs, data=data.frch.mm)
fit.frch <- get_fit(mm.test.frch)
fit.frch
mcmc3 <- get_mcmc(mm.test.frch)
output77 <- rstan::traceplot(mcmc3, pars='K600_daily', nrow=3)
output77
output77
output77
output77 <- rstan::traceplot(mcmc3, pars='GPP_daily', nrow=3)
output77
fit.frch
mm.test.frch
bayes_name
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
library(rstan)
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_name_AppEtAL <- "b_Kb_oipi_tr_plrckm.stan"
bayes_name_AppEtAL
bayes_specs <- specs(bayes_name,
burnin_steps=5000, saved_steps=25000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
dat <- data_metab(num_days='3', res='15', day_start=4, day_end=28)
#FRCH
setwd(here())
FRCH.comb <- read.csv(here("outputs", "frch.comb.csv"))
bayes_specs <- specs(bayes_name,
burnin_steps=5000, saved_steps=50000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
#FRCH
setwd(here())
FRCH.comb <- read.csv(here("outputs", "frch.comb.csv"))
FRCH.comb <- FRCH.comb %>% filter(datetimeAK < "2019-07-07 00:00:00" & datetimeAK >= "2019-07-01 00:00:00")
FRCH.comb$datetimeAK <- force_tz(as.POSIXct(FRCH.comb$datetimeAK), "America/Anchorage")
FRCH.comb$solar.time <- calc_solar_time(as.POSIXct(FRCH.comb$datetimeAK), longitude = -146.916364)
data.frch.mm <- na.omit(FRCH.comb) %>%
select(solar.time, depth, DO.obs, DO.sat, temp.water, light, discharge)
data.frch.mm$solar.time <- as.POSIXct(data.frch.mm$solar.time, tz = "UTC")
parMod <- calc_light(data.frch.mm$solar.time, 64.60667379, -146.916364)
timebounds <- as.POSIXct(c('2019-08-01 00:00:00', '2019-07-01 00:00:00'), tz= "America/Anchorage")
coords <- list(lat=64.60667379, lon=-146.916364)
PAR.obs <- data.frch.mm %>%
select(solar.time, light)
lightmerged <- calc_light_merged( PAR.obs, solar.time = data.frch.mm$solar.time, 64.60667379, -146.916364)
data.frch.mm <- data.frch.mm %>%
dplyr::rename(light.obs = light)
data.frch.mm <- merge(lightmerged, data.frch.mm, by = "solar.time")
data.frch.mm <- na.omit(data.frch.mm) %>%
select(solar.time, depth, DO.obs, DO.sat, temp.water, light, discharge)
mm.test.frch <- metab(bayes_specs, data=data.frch.mm)
fit.frch <- get_fit(mm.test.frch)
fit.frch
mcmc3 <- get_mcmc(mm.test.frch)
output77 <- rstan::traceplot(mcmc3, pars='K600_daily', nrow=3)
output77
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(here)
library(rstan)
#trial Bayes metab run
bayes_name <- mm_name(type='bayes', pool_K600='binned', err_obs_iid=TRUE, err_proc_iid=TRUE)
bayes_name
bayes_name_AppEtAL <- "b_Kb_oipi_tr_plrckm.stan"
bayes_name_AppEtAL
bayes_specs <- specs(bayes_name,
burnin_steps=20000, saved_steps=100000, n_cores=4, n_chains = 4,
GPP_daily_lower = 0, ER_daily_upper = 0
)
#FRCH
setwd(here())
FRCH.comb <- read.csv(here("outputs", "frch.comb.csv"))
FRCH.comb <- FRCH.comb %>% filter(datetimeAK < "2019-07-07 00:00:00" & datetimeAK >= "2019-07-01 00:00:00")
FRCH.comb$datetimeAK <- force_tz(as.POSIXct(FRCH.comb$datetimeAK), "America/Anchorage")
FRCH.comb$solar.time <- calc_solar_time(as.POSIXct(FRCH.comb$datetimeAK), longitude = -146.916364)
data.frch.mm <- na.omit(FRCH.comb) %>%
select(solar.time, depth, DO.obs, DO.sat, temp.water, light, discharge)
data.frch.mm$solar.time <- as.POSIXct(data.frch.mm$solar.time, tz = "UTC")
parMod <- calc_light(data.frch.mm$solar.time, 64.60667379, -146.916364)
timebounds <- as.POSIXct(c('2019-08-01 00:00:00', '2019-07-01 00:00:00'), tz= "America/Anchorage")
coords <- list(lat=64.60667379, lon=-146.916364)
PAR.obs <- data.frch.mm %>%
select(solar.time, light)
lightmerged <- calc_light_merged( PAR.obs, solar.time = data.frch.mm$solar.time, 64.60667379, -146.916364)
data.frch.mm <- data.frch.mm %>%
dplyr::rename(light.obs = light)
data.frch.mm <- merge(lightmerged, data.frch.mm, by = "solar.time")
data.frch.mm <- na.omit(data.frch.mm) %>%
select(solar.time, depth, DO.obs, DO.sat, temp.water, light, discharge)
mm.test.frch <- metab(bayes_specs, data=data.frch.mm)
fit.frch <- get_fit(mm.test.frch)
fit.frch
#### load libraries ####
library(tidyverse)
library(lubridate)
library(ggplot2)
library(xts)
library(data.table)
library(scales)
library(trend)
library(nlme)
C2.service = c("2017-05-23 11:30:00",
"2017-06-06 11:30:00", "2017-06-08 11:00:00", "2017-06-14 11:00:00",
"2017-06-28 10:15:00", "2017-07-05 10:00:00", "2017-07-12 12:15:00",
"2017-07-19 10:30:00", "2017-07-26 10:15:00", "2017-08-02 10:30:00",
"2017-08-08 09:30:00", "2017-08-22 10:00:00")
#Packages I think I might perhaps maybe need...
library(ggpubr)
library(anytime)
library(googlesheets4)
library(ggpmisc)
library(plyr)
library(dplyr)
library(lubridate)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(zoo)
library(xts)
library(forecast)
library(googledrive)
library(streamMetabolizer)
library(readr)
library(data.table)
